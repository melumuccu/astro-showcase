---
import { Icon } from 'astro-icon/components'
---

<hamburger-menu-list>
  <nav aria-label="hamburger-menu">
    <button aria-label="menu-toggle-button">
      <Icon name="material-symbols:menu-rounded" width={24} height={24} />
    </button>
    <ul aria-label="menu" class="menu">
      <slot />
    </ul>
  </nav>
</hamburger-menu-list>

<style>
  nav {
    display: contents;
  }

  button {
    position: relative; /* z-index を効かせるために必要 */
    z-index: var(--z-index-10);
  }

  .menu {
    position: fixed;
    top: 0;
    right: 0;
    z-index: var(--z-index-1);
    width: 85dvw;
    height: 100dvh;
    list-style-type: none;
    background-color: rgb(var(--color--cafe-au-lait--rgb) / 80%);
    transition: transform 0.5s ease-in-out; /* スライドインアニメーション */
    transform: translateX(100dvw); /* メニューを画面外の右側に配置 */
  }

  .menu.is-active {
    transform: translateX(0); /* メニューを画面内にスライドイン */
  }
</style>

<script>
  class HamburgerMenuList extends HTMLElement {
    constructor() {
      super()

      const menu = this.querySelector('*[aria-label="menu"]')
      const hamburgerIcon = this.querySelector(
        '*[aria-label="menu-toggle-button"]'
      )

      /**
       * メニューの表示/非表示を切り替える
       */
      const toggleMenu = () => {
        menu.classList.toggle('is-active')
      }

      // ハンバーガーアイコンにクリックイベントを追加
      hamburgerIcon.addEventListener('click', toggleMenu)

      /**
       * タッチスタート時の処理
       * タッチスタート時の座標を記録する
       */
      const onTouchStart = (event) => {
        touchStartX = event.changedTouches[0].clientX
        isSwiping = false
      }

      /**
       * タッチ移動時の処理
       * タッチ移動後の座標がスタート時の座標よりも指定距離以上右側にあればメニューを閉じる
       */
      const onTouchMove = (event) => {
        const touchMoveX = event.changedTouches[0].clientX
        const swipeDistanceX = touchMoveX - touchStartX

        // 左から右に一定以上スワイプされた場合
        if (!isSwiping && swipeDistanceX > 100) {
          isSwiping = true
          if (menu.classList.contains('is-active')) {
            toggleMenu()
          }
        }
      }
      let touchStartX = 0
      let isSwiping = false

      // メニューにスワイプ検知を追加
      menu.addEventListener('touchstart', onTouchStart)
      menu.addEventListener('touchmove', onTouchMove)
    }
  }
  customElements.define('hamburger-menu-list', HamburgerMenuList)
</script>
